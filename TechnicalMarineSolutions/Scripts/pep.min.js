/*!
 * PEP v0.4.1 | https://github.com/jquery/PEP
 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
 */
(function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):n.PointerEventsPolyfill=t()})(this,function(){"use strict";function at(n,t){var i,r,u,f;for(t=t||Object.create(null),i=document.createEvent("Event"),i.initEvent(n,t.bubbles||!1,t.cancelable||!1),r=2;r<k.length;r++)u=k[r],i[u]=t[u]||lt[r];return i.buttons=t.buttons||0,f=0,f=t.pressure?t.pressure:i.buttons?.5:0,i.x=i.clientX,i.y=i.clientY,i.pointerId=t.pointerId||0,i.width=t.width||0,i.height=t.height||0,i.pressure=f,i.tiltX=t.tiltX||0,i.tiltY=t.tiltY||0,i.pointerType=t.pointerType||"",i.hwTimestamp=t.hwTimestamp||0,i.isPrimary=t.isPrimary||!1,i}function d(){this.array=[];this.size=0}function it(n,t,i,r){this.addCallback=n.bind(r);this.removeCallback=t.bind(r);this.changedCallback=i.bind(r);tt&&(this.observer=new tt(this.mutationWatcher.bind(this)))}function rt(n){return"body /shadow-deep/ "+a(n)}function a(n){return'[touch-action="'+n+'"]'}function s(n){return"{ -ms-touch-action: "+n+"; touch-action: "+n+"; touch-action-delay: none; }"}function fi(){if(ui){ri.forEach(function(n){String(n)===n?(f+=a(n)+s(n)+"\n",ut&&(f+=rt(n)+s(n)+"\n")):(f+=n.selectors.map(a)+s(n.rule)+"\n",ut&&(f+=n.selectors.map(rt)+s(n.rule)+"\n"))});var n=document.createElement("style");n.textContent=f;document.head.appendChild(n)}}function pi(){if(!window.PointerEvent){if(window.PointerEvent=c,window.navigator.msPointerEnabled){var t=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:t,enumerable:!0});n.registerSource("ms",yi)}else n.registerSource("mouse",et),window.ontouchstart!==undefined&&n.registerSource("touch",li);n.register(document)}}function h(t){if(!n.pointermap.has(t))throw new Error("InvalidPointerId");}function wi(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:w},releasePointerCapture:{value:b}})}var k=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],lt=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],c=at,vt=window.Map&&window.Map.prototype.forEach,yt=vt?Map:d,l,ct,w,b;d.prototype={set:function(n,t){if(t===undefined)return this.delete(n);this.has(n)||this.size++;this.array[n]=t},has:function(n){return this.array[n]!==undefined},"delete":function(n){this.has(n)&&(delete this.array[n],this.size--)},get:function(n){return this.array[n]},clear:function(){this.array.length=0;this.size=0},forEach:function(n,t){return this.array.forEach(function(i,r){n.call(t,i,r,this)},this)}};var g=yt,nt=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],pt=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],wt={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},bt=typeof SVGElementInstance!="undefined",o={pointermap:new g,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(n,t){var i=t,r=i.events;r&&(r.forEach(function(n){i[n]&&(this.eventMap[n]=i[n].bind(i))},this),this.eventSources[n]=i,this.eventSourceList.push(i))},register:function(n){for(var r=this.eventSourceList.length,t=0,i;t<r&&(i=this.eventSourceList[t]);t++)i.register.call(i,n)},unregister:function(n){for(var r=this.eventSourceList.length,t=0,i;t<r&&(i=this.eventSourceList[t]);t++)i.unregister.call(i,n)},contains:function(n,t){try{return n.contains(t)}catch(i){return!1}},down:function(n){n.bubbles=!0;this.fireEvent("pointerdown",n)},move:function(n){n.bubbles=!0;this.fireEvent("pointermove",n)},up:function(n){n.bubbles=!0;this.fireEvent("pointerup",n)},enter:function(n){n.bubbles=!1;this.fireEvent("pointerenter",n)},leave:function(n){n.bubbles=!1;this.fireEvent("pointerleave",n)},over:function(n){n.bubbles=!0;this.fireEvent("pointerover",n)},out:function(n){n.bubbles=!0;this.fireEvent("pointerout",n)},cancel:function(n){n.bubbles=!0;this.fireEvent("pointercancel",n)},leaveOut:function(n){this.out(n);this.contains(n.target,n.relatedTarget)||this.leave(n)},enterOver:function(n){this.over(n);this.contains(n.target,n.relatedTarget)||this.enter(n)},eventHandler:function(n){if(!n._handledByPE){var i=n.type,t=this.eventMap&&this.eventMap[i];t&&t(n);n._handledByPE=!0}},listen:function(n,t){t.forEach(function(t){this.addEvent(n,t)},this)},unlisten:function(n,t){t.forEach(function(t){this.removeEvent(n,t)},this)},addEvent:function(n,t){n.addEventListener(t,this.boundHandler)},removeEvent:function(n,t){n.removeEventListener(t,this.boundHandler)},makeEvent:function(n,t){this.captureInfo[t.pointerId]&&(t.relatedTarget=null);var i=new c(n,t);return t.preventDefault&&(i.preventDefault=t.preventDefault),i._target=i._target||t.target,i},fireEvent:function(n,t){var i=this.makeEvent(n,t);return this.dispatchEvent(i)},cloneEvent:function(n){for(var i=Object.create(null),t,r=0;r<nt.length;r++)t=nt[r],i[t]=n[t]||pt[r],bt&&(t==="target"||t==="relatedTarget")&&i[t]instanceof SVGElementInstance&&(i[t]=i[t].correspondingUseElement);return n.preventDefault&&(i.preventDefault=function(){n.preventDefault()}),i},getTarget:function(n){var t=this.captureInfo[n.pointerId];return t?n._target===t||!(n.type in wt)?t:void 0:n._target},setCapture:function(n,t){this.captureInfo[n]&&this.releaseCapture(n);this.captureInfo[n]=t;var i=document.createEvent("Event");i.initEvent("gotpointercapture",!0,!1);i.pointerId=n;this.implicitRelease=this.releaseCapture.bind(this,n);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);i._target=t;this.asyncDispatchEvent(i)},releaseCapture:function(n){var i=this.captureInfo[n],t;i&&(t=document.createEvent("Event"),t.initEvent("lostpointercapture",!0,!1),t.pointerId=n,this.captureInfo[n]=undefined,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),t._target=i,this.asyncDispatchEvent(t))},dispatchEvent:function(n){var t=this.getTarget(n);if(t)return t.dispatchEvent(n)},asyncDispatchEvent:function(n){requestAnimationFrame(this.dispatchEvent.bind(this,n))}};o.boundHandler=o.eventHandler.bind(o);var n=o,i={shadow:function(n){if(n)return n.shadowRoot||n.webkitShadowRoot},canTarget:function(n){return n&&Boolean(n.elementFromPoint)},targetingShadow:function(n){var t=this.shadow(n);if(this.canTarget(t))return t},olderShadow:function(n){var t=n.olderShadowRoot,i;return t||(i=n.querySelector("shadow"),i&&(t=i.olderShadowRoot)),t},allShadows:function(n){for(var i=[],t=this.shadow(n);t;)i.push(t),t=this.olderShadow(t);return i},searchRoot:function(n,t,i){var f,u,r,e;if(n){for(f=n.elementFromPoint(t,i),r=this.targetingShadow(f);r;){if(u=r.elementFromPoint(t,i),u)return e=this.targetingShadow(u),this.searchRoot(e,t,i)||u;r=this.olderShadow(r)}return f}},owner:function(n){for(var t=n;t.parentNode;)t=t.parentNode;return t.nodeType!==Node.DOCUMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(t=document),t},findTarget:function(n){var i=n.clientX,r=n.clientY,t=this.owner(n.target);return t.elementFromPoint(i,r)||(t=document),this.searchRoot(t,i,r)}},kt=Array.prototype.forEach.call.bind(Array.prototype.forEach),dt=Array.prototype.map.call.bind(Array.prototype.map),gt=Array.prototype.slice.call.bind(Array.prototype.slice),ni=Array.prototype.filter.call.bind(Array.prototype.filter),tt=window.MutationObserver||window.WebKitMutationObserver,ti="[touch-action]",ii={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};it.prototype={watchSubtree:function(n){this.observer&&i.canTarget(n)&&this.observer.observe(n,ii)},enableOnSubtree:function(n){this.watchSubtree(n);n===document&&document.readyState!=="complete"?this.installOnLoad():this.installNewSubtree(n)},installNewSubtree:function(n){kt(this.findElements(n),this.addElement,this)},findElements:function(n){return n.querySelectorAll?n.querySelectorAll(ti):[]},removeElement:function(n){this.removeCallback(n)},addElement:function(n){this.addCallback(n)},elementChanged:function(n,t){this.changedCallback(n,t)},concatLists:function(n,t){return n.concat(gt(t))},installOnLoad:function(){document.addEventListener("readystatechange",function(){document.readyState==="complete"&&this.installNewSubtree(document)}.bind(this))},isElement:function(n){return n.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(n){var t=dt(n,this.findElements,this);return t.push(ni(n,this.isElement)),t.reduce(this.concatLists,[])},mutationWatcher:function(n){n.forEach(this.mutationHandler,this)},mutationHandler:function(n){var t,i;n.type==="childList"?(t=this.flattenMutationTree(n.addedNodes),t.forEach(this.addElement,this),i=this.flattenMutationTree(n.removedNodes),i.forEach(this.removeElement,this)):n.type==="attributes"&&this.elementChanged(n.target,n.oldValue)}};l=it;var ri=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],f="",ui=window.PointerEvent||window.MSPointerEvent,ut=!window.ShadowDOMPolyfill&&document.head.createShadowRoot;var r=n.pointermap,ft=25,v=[1,4,2,8,16],u=!1;try{u=new MouseEvent("test",{buttons:1}).buttons===1}catch(bi){}var ei={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(t){n.listen(t,this.events)},unregister:function(t){n.unlisten(t,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(n){for(var u,f,r=this.lastTouches,e=n.clientX,o=n.clientY,t=0,s=r.length,i;t<s&&(i=r[t]);t++)if(u=Math.abs(e-i.x),f=Math.abs(o-i.y),u<=ft&&f<=ft)return!0},prepareEvent:function(t){var i=n.cloneEvent(t),r=i.preventDefault;return i.preventDefault=function(){t.preventDefault();r()},i.pointerId=this.POINTER_ID,i.isPrimary=!0,i.pointerType=this.POINTER_TYPE,i},prepareButtonsForMove:function(n,t){var i=r.get(this.POINTER_ID);n.buttons=i?i.buttons:0;t.buttons=n.buttons},mousedown:function(t){if(!this.isEventSimulatedFromTouch(t)){var f=r.get(this.POINTER_ID),i=this.prepareEvent(t);u||(i.buttons=v[i.button],f&&(i.buttons|=f.buttons),t.buttons=i.buttons);r.set(this.POINTER_ID,t);f?n.move(i):n.down(i)}},mousemove:function(t){if(!this.isEventSimulatedFromTouch(t)){var i=this.prepareEvent(t);u||this.prepareButtonsForMove(i,t);n.move(i)}},mouseup:function(t){var f,i,e;this.isEventSimulatedFromTouch(t)||(f=r.get(this.POINTER_ID),i=this.prepareEvent(t),u||(e=v[i.button],i.buttons=f?f.buttons&~e:0,t.buttons=i.buttons),r.set(this.POINTER_ID,t),i.buttons===0||i.buttons===v[i.button]?(this.cleanupMouse(),n.up(i)):n.move(i))},mouseover:function(t){if(!this.isEventSimulatedFromTouch(t)){var i=this.prepareEvent(t);u||this.prepareButtonsForMove(i,t);n.enterOver(i)}},mouseout:function(t){if(!this.isEventSimulatedFromTouch(t)){var i=this.prepareEvent(t);u||this.prepareButtonsForMove(i,t);n.leaveOut(i)}},cancel:function(t){var i=this.prepareEvent(t);n.cancel(i);this.cleanupMouse()},cleanupMouse:function(){r.delete(this.POINTER_ID)}},et=ei,oi=n.captureInfo,si=i.findTarget.bind(i),y=i.allShadows.bind(i),t=n.pointermap,hi=2500,ci=200,ot="touch-action",st,p=!1,e={events:["touchstart","touchmove","touchend","touchcancel"],register:function(t){p?n.listen(t,this.events):st.enableOnSubtree(t)},unregister:function(t){p&&n.unlisten(t,this.events)},elementAdded:function(t){var r=t.getAttribute(ot),i=this.touchActionToScrollType(r);i&&(t._scrollType=i,n.listen(t,this.events),y(t).forEach(function(t){t._scrollType=i;n.listen(t,this.events)},this))},elementRemoved:function(t){t._scrollType=undefined;n.unlisten(t,this.events);y(t).forEach(function(t){t._scrollType=undefined;n.unlisten(t,this.events)},this)},elementChanged:function(n,t){var u=n.getAttribute(ot),i=this.touchActionToScrollType(u),r=this.touchActionToScrollType(t);i&&r?(n._scrollType=i,y(n).forEach(function(n){n._scrollType=i},this)):r?this.elementRemoved(n):i&&this.elementAdded(n)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(n){var t=n,i=this.scrollTypes;return t==="none"?"none":t===i.XSCROLLER?"X":t===i.YSCROLLER?"Y":i.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(n){return this.firstTouch===n.identifier},setPrimaryTouch:function(n){(t.size===0||t.size===1&&t.has(1))&&(this.firstTouch=n.identifier,this.firstXY={X:n.clientX,Y:n.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(n){n.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var n=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(n,ci)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(n){var t=0;return(n==="touchstart"||n==="touchmove")&&(t=1),t},touchToPointer:function(t){var u=this.currentTouchEvent,i=n.cloneEvent(t),f=i.pointerId=t.identifier+2,r;return i.target=oi[f]||si(i),i.bubbles=!0,i.cancelable=!0,i.detail=this.clickCount,i.button=0,i.buttons=this.typeToButtons(u.type),i.width=t.radiusX||t.webkitRadiusX||0,i.height=t.radiusY||t.webkitRadiusY||0,i.pressure=t.force||t.webkitForce||.5,i.isPrimary=this.isPrimaryTouch(t),i.pointerType=this.POINTER_TYPE,r=this,i.preventDefault=function(){r.scrolling=!1;r.firstXY=null;u.preventDefault()},i},processTouches:function(n,t){var r=n.changedTouches,i,u;for(this.currentTouchEvent=n,i=0;i<r.length;i++)u=r[i],t.call(this,this.touchToPointer(u))},shouldScroll:function(n){var i,t;if(this.firstXY){if(t=n.currentTarget._scrollType,t==="none")i=!1;else if(t==="XY")i=!0;else{var r=n.changedTouches[0],u=t,f=t==="Y"?"X":"Y",e=Math.abs(r["client"+u]-this.firstXY[u]),o=Math.abs(r["client"+f]-this.firstXY[f]);i=e>=o}return this.firstXY=null,i}},findTouch:function(n,t){for(var i=0,u=n.length,r;i<u&&(r=n[i]);i++)if(r.identifier===t)return!0},vacuumTouches:function(n){var r=n.touches,i;t.size>=r.length&&(i=[],t.forEach(function(n,t){if(t!==1&&!this.findTouch(r,t-2)){var u=n.out;i.push(u)}},this),i.forEach(this.cancelOut,this))},touchstart:function(n){this.vacuumTouches(n);this.setPrimaryTouch(n.changedTouches[0]);this.dedupSynthMouse(n);this.scrolling||(this.clickCount++,this.processTouches(n,this.overDown))},overDown:function(i){t.set(i.pointerId,{target:i.target,out:i,outTarget:i.target});n.over(i);n.enter(i);n.down(i)},touchmove:function(n){this.scrolling||(this.shouldScroll(n)?(this.scrolling=!0,this.touchcancel(n)):(n.preventDefault(),this.processTouches(n,this.moveOverOut)))},moveOverOut:function(i){var r=i,u=t.get(r.pointerId),f,e;u&&(f=u.out,e=u.outTarget,n.move(r),f&&e!==r.target&&(f.relatedTarget=r.target,r.relatedTarget=e,f.target=e,r.target?(n.leaveOut(f),n.enterOver(r)):(r.target=e,r.relatedTarget=null,this.cancelOut(r))),u.out=r,u.outTarget=r.target)},touchend:function(n){this.dedupSynthMouse(n);this.processTouches(n,this.upOut)},upOut:function(t){this.scrolling||(n.up(t),n.out(t),n.leave(t));this.cleanUpPointer(t)},touchcancel:function(n){this.processTouches(n,this.cancelOut)},cancelOut:function(t){n.cancel(t);n.out(t);n.leave(t);this.cleanUpPointer(t)},cleanUpPointer:function(n){t.delete(n.pointerId);this.removePrimaryPointer(n)},dedupSynthMouse:function(n){var r=et.lastTouches,t=n.changedTouches[0],i,u;this.isPrimaryTouch(t)&&(i={x:t.clientX,y:t.clientY},r.push(i),u=function(n,t){var i=n.indexOf(t);i>-1&&n.splice(i,1)}.bind(null,r,i),setTimeout(u,hi))}};p||(st=new l(e.elementAdded,e.elementRemoved,e.elementChanged,e));var li=e,ht=n.pointermap,ai=window.MSPointerEvent&&typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE=="number",vi={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(t){n.listen(t,this.events)},unregister:function(t){n.unlisten(t,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(t){var i=t;return ai&&(i=n.cloneEvent(t),i.pointerType=this.POINTER_TYPES[t.pointerType]),i},cleanup:function(n){ht.delete(n)},MSPointerDown:function(t){ht.set(t.pointerId,t);var i=this.prepareEvent(t);n.down(i)},MSPointerMove:function(t){var i=this.prepareEvent(t);n.move(i)},MSPointerUp:function(t){var i=this.prepareEvent(t);n.up(i);this.cleanup(t.pointerId)},MSPointerOut:function(t){var i=this.prepareEvent(t);n.leaveOut(i)},MSPointerOver:function(t){var i=this.prepareEvent(t);n.enterOver(i)},MSPointerCancel:function(t){var i=this.prepareEvent(t);n.cancel(i);this.cleanup(t.pointerId)},MSLostPointerCapture:function(t){var i=n.makeEvent("lostpointercapture",t);n.dispatchEvent(i)},MSGotPointerCapture:function(t){var i=n.makeEvent("gotpointercapture",t);n.dispatchEvent(i)}},yi=vi;return ct=window.navigator,ct.msPointerEnabled?(w=function(n){h(n);this.msSetPointerCapture(n)},b=function(n){h(n);this.msReleasePointerCapture(n)}):(w=function(t){h(t);n.setCapture(t,this)},b=function(t){h(t);n.releaseCapture(t,this)}),fi(),pi(),wi(),{dispatcher:n,Installer:l,PointerEvent:c,PointerMap:g,targetFinding:i}});